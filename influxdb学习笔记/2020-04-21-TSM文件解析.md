# TSM问题总结

通过回答问题的方式学习TSM文件。

## 1.tsm文件结构是怎么样的？

每个TSM文件由四个部分组成：header,blocks,index,footer：
```markdown
+--------+------------------------------------+-------------+--------------+
| Header |               Blocks               |    Index    |    Footer    |
|5 bytes |              N bytes               |   N bytes   |   4 bytes    |
+--------+------------------------------------+-------------+--------------+
```

Header部分是由一个magic number（用以标记文件类型）和一个version number组成：
```markdown
+-------------------+
|      Header       |
+-------------------+
|  Magic  │ Version |
| 4 bytes │ 1 byte  |
+-------------------+
```




## 2.tsm文件是如何写入的？





## 3.tsm文件是如何读取的？







## 4.tsm文件是如何做compaction的，和写入及读取的关系是啥？即如何防止竞态？


